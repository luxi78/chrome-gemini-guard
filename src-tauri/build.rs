fn main() {
    let manifest_dir =
        std::env::var("CARGO_MANIFEST_DIR").expect("CARGO_MANIFEST_DIR should be set");
    let icons_dir = std::path::Path::new(&manifest_dir).join("icons");
    let _ = std::fs::create_dir_all(&icons_dir);
    let icon_path = icons_dir.join("icon.ico");
    let png_path = icons_dir.join("icon.png");

    if !icon_path.exists() {
        // Minimal 1x1 ICO (32-bit BGRA) generated at build time.
        let icon_bytes: [u8; 70] = [
            0x00, 0x00, 0x01, 0x00, 0x01, 0x00, // ICONDIR
            0x01, 0x01, 0x00, 0x00, 0x01, 0x00, 0x20, 0x00, 0x30, 0x00, 0x00, 0x00, 0x16, 0x00,
            0x00, 0x00, // ICONDIRENTRY
            0x28, 0x00, 0x00, 0x00, // BITMAPINFOHEADER size
            0x01, 0x00, 0x00, 0x00, // width
            0x02, 0x00, 0x00, 0x00, // height (color+mask)
            0x01, 0x00, // planes
            0x20, 0x00, // bitcount
            0x00, 0x00, 0x00, 0x00, // compression
            0x04, 0x00, 0x00, 0x00, // sizeimage
            0x00, 0x00, 0x00, 0x00, // xppm
            0x00, 0x00, 0x00, 0x00, // yppm
            0x00, 0x00, 0x00, 0x00, // clr used
            0x00, 0x00, 0x00, 0x00, // clr important
            0x33, 0x99, 0xff, 0xff, // pixel BGRA
            0x00, 0x00, 0x00, 0x00, // AND mask
        ];
        std::fs::write(&icon_path, icon_bytes).expect("failed to write generated icon");
    }

    if !png_path.exists() {
        // Minimal 1x1 PNG.
        let png_bytes: [u8; 68] = [
            0x89, 0x50, 0x4e, 0x47, 0x0d, 0x0a, 0x1a, 0x0a, 0x00, 0x00, 0x00, 0x0d, 0x49, 0x48,
            0x44, 0x52, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x08, 0x04, 0x00, 0x00,
            0x00, 0xb5, 0x1c, 0x0c, 0x02, 0x00, 0x00, 0x00, 0x0b, 0x49, 0x44, 0x41, 0x54, 0x78,
            0xda, 0x63, 0xfc, 0xff, 0x1f, 0x00, 0x03, 0x03, 0x02, 0x00, 0xee, 0xd9, 0xef, 0x14,
            0x00, 0x00, 0x00, 0x00, 0x49, 0x45, 0x4e, 0x44, 0xae, 0x42, 0x60, 0x82,
        ];
        std::fs::write(&png_path, png_bytes).expect("failed to write generated png icon");
    }

    let attrs = tauri_build::Attributes::new()
        .windows_attributes(tauri_build::WindowsAttributes::new().window_icon_path(&icon_path));
    tauri_build::try_build(attrs).expect("failed to run tauri build script");
}
